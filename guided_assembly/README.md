# Guided assembly

Author: bansho masutani

# Summary

This is a repository to reproduce the existing algorithms.
Currently, most of the assembly procedure for plant mitochondria is to
1. filter out mitochondrial genome
2. assemble them
3. Circulalizing them

In this repository, I clone the first two procedure to
prove that this method goes wrong.


# Synopsis
## upper bound of P-value of the nucleotide conposition at each position
```bash
cargo run --release --bin calc_p_value_at_each_position -- [bam file] [substitution rate] > [tsv file]
```
where [substitution rate] is the rate at which a base would be read as one of other three base by a sequence mistakenly(e.g., around 5% for PacBio, 6% for ONT)

The result is a tab-separated file each line containing tid, position, and its upper bound of p-value.


## Reproduce

### Requirement

- minialign: Version: 0.6.0-44-g5fd40a5, Build: SSE4.1
- miniamp2: Version: 2.17-r943-dirty
- canu: Version: 1.8
- wtdbg2 : 2.3
- Flye: 2.4-g0d3aea2
- Ra: v0.2.1
- Samtools : 1.9

### Command

```
qsub ./scritp/guided_assembly_mother.job
```

After manual curation, the pictues generated.

To produce the 


## What's this?

### ./script/all_vs_all_filtered.job

Dependency: ./script/guided_mother.job

Do all vs all alignment of /grid/ban-m/arabidopsis_thaliana/sequel/guided_asm/filtered_reads_remove_chimera.fq.
The output would be write into ./result/sequel_all_vs_all_filtered.paf


### ./script_calc_p_value.R

Dependency: ./script/guided_mother.job

Calculate the p-value of the given file, and output the plot into the second argument.
This script is used to call SNV/SNP at each position at each contig.
To see more detail, see ./script/call_svn_position.job

### ./script/call_snv_position.job

This script scan the 'mapback' of each assembly, and call snv in very naive manner.
The output would be written to ./result/sequel_canu_P_value.tsv or other files like this.

### ./scritpt/canu.job

This is a wrapper script of canu.


### ./script/canu_sequel_trimed_reads.job


????

### ./script/collect_assemblies.sh

This is to collect assmblies from /grid/.

### ./script/command.dat

This is a script to get a record from fastq file by its ID, and converted it to fasta, and write to ./result/[ID].fa.
Also, it is automatically do that for trimmed dataset.

I create it to check the trimming efficiency. /grid/ban-m/arabidopsis_thaliana/sequel/guided_asm/filtered_reads.fq and ./filtered_reads_remoev_chimera.fq are needed.


### ./script/compare_mapback.job

Dependencies: BAM files(Mapped reads for each assemblies). fastq file(original reads).

This is to see the efficiency of collecting mito-reads. Output is the Benn's-like-ascii file.

### ./script/compare_mapback_summarize.R

This is a vilualizer of the ouput generated by "./script/compare_mapback.job"

### ./scritp/coverage.R

This script is to plot a coverage represented by wig file.

### ./script/coverage_verify.sh

This is a wrapper script of the two script above.


### ./script/dotplot_eachother.job

This is a script to exec Gepard for each assembly.


### ./script/flye.job
wrapper script for flye.


### ./script/guided_assembly_mother.sh

This is a main script for this crate.
It first maps the entire dataset into the reference genome, then, it filtering out the reads mapped to mitochondrial genome.

Then, it detectes self-chimer and chops the reads. Then, supply it to each assemblers: canu, flye, ra, and wtdbg2.

### ./script/guided_assembly_postprocess.sh

This script execute mapback.

### ./kmer_frequency.R

To plot kmer-frequency.

### ./script/mapback_after_breaking.job

I split a contig at the center, and map everything back.


### ./script/ra.job

A wrapper of ra.

### ./script/selected_reads_to_guided_assembly.job

This script should be moved to ./dilution_assembly.

### selected_pileup.job

Get a pileup at specific position


### ./script/self_self.job

DO self-self alignment.

### snv and sv callung.job

Do sniffles and freebayes on a assembly.

## start_and_stop_read_plot.R

plot a start and stop data. Needs tsv for coverage, and tsv for peaks.

## start and stop read.sh

Exec everything needed to start and stop read analysis

## subsample

subsample bam.


### tiling_by_stiff_sequence.job

Tiling each reads by stiff sequence, a.k.a. assembly contig.
reads, contigs, peak call files are needed. Inside the program, LAST aligner is used.

### tiling_mother.sh

Do tiling analysis for canu.

### trim_genomic_region.job

This is to plot a coverage of genomic region. In fact, it is very diverge.

### wtdbg2.job

Wrapper script for wtdbg2.









